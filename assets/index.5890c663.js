var it=Object.defineProperty;var ot=(i,t,e)=>t in i?it(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var p=(i,t,e)=>(ot(i,typeof t!="symbol"?t+"":t,e),e);import{v as rt,n as st,C as L,M as G,a as V,F as at,B as j,b as lt,S as ct,P as dt,W as ut,O as ht,V as x,R as ft,c as gt,d as mt,s as X}from"./vendor.60c5d1df.js";const pt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}};pt();function St(i={}){const{immediate:t=!1,onNeedRefresh:e,onOfflineReady:o,onRegistered:n,onRegisterError:r}=i;let s,a;const l=async(c=!0)=>{c&&(s==null||s.addEventListener("controlling",d=>{d.isUpdate&&window.location.reload()})),a&&a.waiting&&await st(a.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){s=new rt("/cuble/sw.js",{scope:"/cuble/",type:"classic"}),s.addEventListener("activated",c=>{c.isUpdate||o==null||o()});{const c=()=>{e==null||e()};s.addEventListener("waiting",c),s.addEventListener("externalwaiting",c)}s.register({immediate:t}).then(c=>{a=c,n==null||n(c)}).catch(c=>{r==null||r(c)})}return l}var m=function(){this.phase=0,this.currentState=null,this.goalState=null};m.prototype.applyMove=function(i,t){for(var e=[[0,1,2,3,0,1,2,3],[4,7,6,5,4,5,6,7],[0,9,4,8,0,3,5,4],[2,10,6,11,2,1,7,6],[3,11,7,9,3,2,6,5],[1,8,5,10,1,0,4,7]],o=i%3+1,n=Math.floor(i/3),r=t.slice();o-- >0;)for(var s=r.slice(),a=0;a<8;a++){var l=a>3,c=e[n][a]+l*12,d=e[n][(a&3)==3?a-3:a+1]+l*12,y=a<4?n>1&&n<4:n<2?0:2-(a&1);r[c]=s[d],r[c+20]=s[d+20]+y,o==0&&(r[c+20]%=2+l)}return r};m.prototype.inverse=function(i){return i+2-2*(i%3)};m.prototype.getId=function(i){if(this.phase<2)return JSON.stringify(i.slice(20,32));if(this.phase<3){for(var t=i.slice(31,40),e=0;e<12;e++)t[0]|=Math.floor(i[e]/8)<<e;return JSON.stringify(t)}if(this.phase<4){for(var t=[0,0,0],e=0;e<12;e++)t[0]|=(i[e]>7?2:i[e]&1)<<2*e;for(var o=0;o<8;o++)t[1]|=(i[o+12]-12&5)<<3*o;for(var n=12;n<20;n++)for(var r=n+1;r<20;r++)t[2]^=i[n]>i[r];return JSON.stringify(t)}return JSON.stringify(i)};m.prototype.setState=function(i){if(i=i.split(" "),i.length!=20)return this.currentState="Not enough cubies provided",!1;var t=["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL","UFR","URB","UBL","ULF","DRF","DFL","DLB","DBR"];this.currentState=new Array(40),this.goalState=new Array(40);for(var e=0;e<40;e++)this.currentState[e]=0,this.goalState[e]=0;for(var e=0;e<20;e++){this.goalState[e]=e;for(var o=i[e];(this.currentState[e]=t.indexOf(o))==-1;)if(o=o.substr(1)+o[0],this.currentState[e+20]++,this.currentState[e+20]>2)return this.currentState="Cannot solve: Invalid painting of cube.",!1;t[t.indexOf(o)]=""}return this.verifyState()};m.prototype.verifyState=function(){if(!Array.isArray(this.currentState))return!1;var i=0;if(this.currentState.slice(20,32).forEach(function(e){i+=e}),i%2!=0)return this.currentState="Cannot solve: Edges not oriented correctly.",!1;if(i=0,this.currentState.slice(32,40).forEach(function(e){i+=e}),i%3!=0)return this.currentState="Cannot solve: Corners not oriented correctly",!1;var t=function(e){for(var o=0,n=0;n<e.length;n++)for(var r=0;r<n;r++)if(e[r]>e[n]){o++;var s=e[n];e[n]=e[r],e[r]=s}return o};return i=0,i+=t(this.currentState.slice(0,12)),i+=t(this.currentState.slice(12,20)),i%2!=0?(this.currentState="Cannot solve: Parity error only one set of corners or edges swapped.",!1):!0};m.prototype.edgeParity=function(){let i=0;return this.currentState.slice(20,32).forEach(t=>i+=t),i%2};m.prototype.cornerParity=function(){let i=0;return this.currentState.slice(32,40).forEach(t=>i+=t),i%3};m.prototype.permutationParity=function(){if(this.currentState.includes(-1))return"N/A";let i=e=>{let o=0;for(let n=0;n<e.length;n++)for(let r=0;r<n;r++)if(e[r]>e[n]){o++;let s=e[n];e[n]=e[r],e[r]=s}return o},t=i(this.currentState.slice(0,12));return t+=i(this.currentState.slice(12,20)),t%2};m.prototype.solve=function(i){if(this.solution="",this.phase=0,i){if(!this.setState(i))return!1}else if(!this.verifyState())return!1;for(;++this.phase<5;)this.startPhase();return this.prepareSolution(),this.solution};m.prototype.solveAsync=function(i,t,e){if(this.solution="",this.phase=1,i){if(!this.setState(i)){t(!1);return}}else if(!this.verifyState()){t(!1);return}var o=function(){this.phase<5?(this.startPhase(),e&&e(this.phase/5),this.phase++,setTimeout(o.bind(this),0)):(e&&e(1),this.prepareSolution(),t(this.solution))};o.bind(this)()};m.prototype.startPhase=function(){var i=this.getId(this.currentState),t=this.getId(this.goalState);if(i!=t){var e=[];e.push(this.currentState),e.push(this.goalState);var o={},n={},r={};for(n[i]=1,n[t]=2;;)for(var s=e.shift(),a=this.getId(s),l=n[a],c=[0,262143,259263,74943,74898],d=0;d<18;d++)if(c[this.phase]&1<<d){var y=this.applyMove(d,s),g=this.getId(y),w=n[g];if(w&&w!=l){if(l>1){var I=g,g=a,a=I;d=this.inverse(d)}for(var v=[d];a!=i;)v.unshift(r[a]),a=o[a];for(;g!=t;)v.push(this.inverse(r[g])),g=o[g];for(var D=0;D<v.length;D++){for(var A=0;A<v[D]%3+1;A++)this.solution+="UDFBLR"[Math.floor(v[D]/3)];this.currentState=this.applyMove(v[D],this.currentState)}return}w||(e.push(y),n[g]=n[a],r[g]=d,o[g]=a)}}};m.prototype.prepareSolution=function(){var i=this.solution.match(/(\w)\1*/g);if(!i){this.solution="";return}for(var t={F:"B",B:"F",T:"D",D:"T",R:"L",L:"R"},e="",o=0;o<i.length-2;o++)i[o][0]==i[o+2][0]&&t[i[o+1][0]]==i[o][0]&&(temp=i[o+2],i[o+2]=i[o+1],i[o+1]=temp,o=0);i=i.join("").match(/(\w)\1*/g),i.forEach(function(n){if(n.length%4==1)e+=n[0];else if(n.length%4==2)e+=n[0]+"2";else if(n.length%4==3)e+=n[0]+"'";else if(n.length%4==0)return;e+=" "}),this.solution=e.trim()};const Z={U:new L(16777215),R:new L(15343619),F:new L(5104690),D:new L(16182581),L:new L(16093725),B:new L(6468577),X:new L(4473924)},u=class{constructor(t){t.width*=window.devicePixelRatio,t.height*=window.devicePixelRatio,t.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),this.canvas=t.getContext("2d"),this.width=t.width,this.height=t.height}drawSquare(t,e,o,n){this.canvas.fillStyle=`rgb(${o.r*256}, ${o.g*256}, ${o.b*256})`,this.canvas.fillRect(t,e,u.SIZE,u.SIZE),n!=="."&&(this.canvas.beginPath(),this.canvas.moveTo(t+u.SIZE,e),this.canvas.lineTo(t,e+u.SIZE),this.canvas.stroke()),n==="X"&&(this.canvas.beginPath(),this.canvas.moveTo(t,e),this.canvas.lineTo(t+u.SIZE,e+u.SIZE),this.canvas.stroke())}drawFace(t,e,o,n){for(let r=0;r<3;r++)for(let s=0;s<3;s++)this.drawSquare(t+r*u.SIZE+r,e+s*u.SIZE+s,Z[o[s*3+r]],n[s*3+r])}drawCube(t,e){const o=u.getFeedback(t,e);this.canvas.clearRect(0,0,this.width,this.height),this.drawFace(u.FACESIZE,0,t.slice(0,9),o.slice(0,9));for(let n=0;n<4;n++)this.drawFace(n*u.FACESIZE,u.FACESIZE,t.slice(n*9+9,n*9+18),o.slice(n*9+9,n*9+18));this.drawFace(u.FACESIZE,u.FACESIZE*2,t.slice(45),o.slice(45))}static getFeedback(t,e){const o=[];for(let n=0;n<6;n++){const r={U:0,L:0,F:0,R:0,B:0,D:0},s={U:0,L:0,F:0,R:0,B:0,D:0};for(let a=0;a<9;a++){const l=n*9+a;t[l]!==e[l]&&(a%2===0?s[e[l]]++:r[e[l]]++)}for(let a=0;a<9;a++){const l=n*9+a;t[l]===e[l]?o.push("."):a%2===0&&s[t[l]]-- >0||a%2!==0&&r[t[l]]-- >0?o.push("/"):o.push("X")}}return o}};let U=u;p(U,"SIZE",document.getElementById("feedback").height/10),p(U,"PADDING",5),p(U,"FACESIZE",u.SIZE*3+u.PADDING);class yt extends G{constructor(t,e,o,n){const s=new V({vertexColors:at}),a=[];for(let c=0;c<36;c++)a.push(0,0,0);const l=new j().toNonIndexed();l.setAttribute("color",new lt(a,3));super(l,s);this.position.set(t,e,o),this.scale.set(.95,.95,.95),this.name=n,this.setColors(n)}setColors(t){if(t.length!==this.name.length)throw`Expected ${this.name.length} colors but got ${t}.`;this.colors=t;const e={R:0,L:6,U:12,D:18,F:24,B:30},o=this.geometry.getAttribute("color");for(let n=0;n<this.name.length;n++){const r=Z[t.charAt(n)];for(let s=0;s<6;s++)o.setXYZ(e[this.name.charAt(n)]+s,r.r,r.g,r.b)}this.geometry.attributes.color.needsUpdate=!0}erase(){this.setColors("XXX".substring(0,this.name.length))}rotate(){this.setColors(this.colors.substring(1)+this.colors.charAt(0))}}const B=class{constructor(t){p(this,"savedCubies",[]);p(this,"throttle",!0);p(this,"permutation",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);p(this,"orientation",new Array(20).fill(0));this.scene=new ct,this.camera=new dt(90,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(5,5,5),this.renderer=new ut({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio||1);const e=new ht(this.camera,this.renderer.domElement);e.enablePan=!1,e.enableZoom=!1,this.selection=new G(new j,new V({color:"black",transparent:!0,opacity:.5})),this.selection.visible=!1,this.scene.add(this.selection),document.body.appendChild(this.renderer.domElement),this.animate();const o=["DLB","DL","DFL","BL","L","FL","UBL","UL","ULF","DB","D","DF","B","","F","UB","U","UF","DBR","DR","DRF","BR","R","FR","URB","UR","UFR"];for(let n=0;n<3;n++)for(let r=0;r<3;r++)for(let s=0;s<3;s++){const a=new yt(n-1,r-1,s-1,o[n*9+r*3+s]);this.savedCubies.push(a),this.scene.add(a)}this.renderer.domElement.addEventListener("pointerdown",n=>{this.throttle=!1,this.cursorPos=[n.clientX,n.clientY]}),this.renderer.domElement.addEventListener("pointerup",n=>{if(this.throttle=!0,document.getElementById("actions").childElementCount===1||Math.hypot(n.clientX-this.cursorPos[0],n.clientY-this.cursorPos[1])>1)return;const r=this.findClickedCubie(n);!r||this.initPicker(r.object)}),this.answerPermutation=t.slice(0,20),this.answerOrientation=t.slice(20),window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)})}isCenterName(t){return typeof t!="string"||t.length!==2&&t.length!==3}initPicker(t,e){const o=document.getElementById("picker"),n=document.getElementById("erase"),r=document.getElementById("rotate");if(this.isCenterName(t.name)){this.selection.position.copy(t.position),this.selection.visible=!0,this.selection.material.opacity=.25,n.disabled=!0,r.disabled=!0,o.replaceChildren();return}const s=B.getStateIndex(t.name);if(o.replaceChildren(),!e&&t.position.equals(this.selection.position)){this.selection.position.set(0,0,0),this.selection.visible=!1,n.disabled=!0,r.disabled=!0;return}if(this.selection.position.copy(t.position),this.selection.visible=!0,this.selection.material.opacity=.5,this.correct(s)){n.disabled=!0,r.disabled=!0,this.selection.material.opacity=.25;return}const a=[];t.name.length===2?a.push("UB","UL","DB","DL","BL","FL","UF","UR","DF","DR","BR","FR"):a.push("UBL","ULF","UFR","URB","DLB","DFL","DRF","DBR");for(const l of a){const c=l.length===2?6:4,d=o.appendChild(document.createElement("button"));d.classList.add("cubie"),d.style.width=(o.offsetWidth-10*c)/c+"px";const y=d.appendChild(document.createElement("canvas"));y.width=d.clientWidth,y.height=d.clientHeight;const g=y.getContext("2d");for(let w=0;w<l.length;w++){const I=Z[l.charAt(w)],v=y.width/l.length;g.fillStyle=`rgb(${I.r*256}, ${I.g*256}, ${I.b*256})`,g.fillRect(v*w,0,v,y.height)}d.disabled=this.permutation.includes(B.getStateIndex(l)),d.onclick=()=>{t.setColors(l),this.permutation[s]=B.getStateIndex(l),this.orientation[s]=0,this.initPicker(t,!0),this.updateParity()}}n.disabled=!1,n.onclick=()=>{t.erase(),this.permutation[s]=-1,this.initPicker(t,!0),this.updateParity()},r.disabled=!1,r.onclick=()=>{t.rotate(),this.orientation[s]--,this.orientation[s]<0&&(this.orientation[s]=t.name.length-1),this.updateParity()}}updateParity(){const t=new m;t.currentState=[...this.permutation,...this.orientation];const e=t.edgeParity(),o=t.cornerParity(),n=t.permutationParity(),r=document.getElementById("parity");r.innerText=`EP: ${e}, CP: ${o}, PP: ${n}`,r.style.color=e||o||n?"red":"white"}correct(t){const e=window.getStorageKey||(a=>a),o=localStorage.getItem(e("permutation")),n=localStorage.getItem(e("orientation"));if(!o||!n)return!1;const r=JSON.parse(o),s=JSON.parse(n);return r[t]===this.answerPermutation[t]&&s[t]===this.answerOrientation[t]}save(){const t=window.getStorageKey||(e=>e);for(const e of this.savedCubies)localStorage.setItem(t(e.name),e.colors);localStorage.setItem(t("permutation"),JSON.stringify(this.permutation)),localStorage.setItem(t("orientation"),JSON.stringify(this.orientation))}load(){const t=window.getStorageKey||(n=>n);for(const n of this.savedCubies){const r=localStorage.getItem(t(n.name));n.setColors(r||n.name)}const e=localStorage.getItem(t("permutation"));this.permutation=e?JSON.parse(e):[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19];const o=localStorage.getItem(t("orientation"));this.orientation=o?JSON.parse(o):new Array(20).fill(0)}static getStateIndex(t){return B.CUBIE_ORDER.indexOf(t)}navigateWASD(t){if(!this.selection.visible)return;let e=null;for(const s of this.savedCubies)if(s.position.equals(this.selection.position)){e=s;break}if(!e||this.isCenterName(e.name))return;const o=B.ADJACENCY_MAP[e.name];if(!o||o.length===0)return;const n=this.getDirectionalTarget(e,t,this.camera);if(!n)return;const r=this.savedCubies.find(s=>s.name===n);r&&this.initPicker(r)}getDirectionalTarget(t,e,o){e=typeof e=="string"?e.toLowerCase():e;const n=B.ADJACENCY_MAP[t.name];if(!n)return null;const r=new x;o.getWorldDirection(r);const s=o.up.clone().normalize();let a=new x().crossVectors(r,s).normalize();a.lengthSq()<1e-4&&a.set(1,0,0).applyQuaternion(o.quaternion);const l=new x().crossVectors(a,r).normalize(),c=e==="w"||e==="s";let d=null;c?d=e==="w"?l.clone():l.clone().negate():d=e==="d"?a.clone():a.clone().negate();const y=t.position;let g=null,w=-1/0;const I=c?a:l;for(const v of n){const D=this.savedCubies.find(nt=>nt.name===v);if(!D)continue;const A=new x().subVectors(D.position,y).normalize(),O=A.dot(d),et=Math.abs(A.dot(I));O>w&&O>et&&(w=O,g=v)}return w>.5?g:null}findClickedCubie(t){const e=new gt;e.x=t.clientX/window.innerWidth*2-1,e.y=-(t.clientY/window.innerHeight)*2+1;const o=new ft;return o.setFromCamera(e,this.camera),o.intersectObjects(this.scene.children)[0]}animate(){this.throttle?setTimeout(()=>{requestAnimationFrame(()=>this.animate())},1e3/10):requestAnimationFrame(()=>this.animate()),this.renderer.render(this.scene,this.camera)}};let E=B;p(E,"CUBIE_ORDER",["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL","UFR","URB","UBL","ULF","DRF","DFL","DLB","DBR"]),p(E,"CUBIE_COORDINATES",{UF:[1,2,2],UR:[2,1,2],UB:[1,0,2],UL:[0,1,2],DF:[1,2,0],DR:[2,1,0],DB:[1,0,0],DL:[0,1,0],FR:[2,2,1],FL:[0,2,1],BR:[2,0,1],BL:[0,0,1],UFR:[2,2,2],URB:[2,0,2],UBL:[0,0,2],ULF:[0,2,2],DRF:[2,2,0],DFL:[0,2,0],DLB:[0,0,0],DBR:[2,0,0]}),p(E,"COORDINATE_TO_CUBIE",{}),p(E,"ADJACENCY_MAP",{UFR:["UF","FR","UR"],URB:["UR","BR","UB"],UBL:["UB","BL","UL"],ULF:["UL","FL","UF"],DRF:["DF","FR","DR"],DFL:["DF","FL","DL"],DLB:["DL","BL","DB"],DBR:["DB","BR","DR"],UF:["UFR","ULF"],UR:["UFR","URB"],UB:["URB","UBL"],UL:["UBL","ULF"],DF:["DRF","DFL"],DR:["DRF","DBR"],DB:["DBR","DLB"],DL:["DLB","DFL"],FR:["UFR","DRF"],FL:["ULF","DFL"],BR:["URB","DBR"],BL:["UBL","DLB"]}),(()=>{for(const[t,e]of Object.entries(B.CUBIE_COORDINATES))B.COORDINATE_TO_CUBIE[e.join(",")]=t})();const R=class{constructor(t){this.canvas=t}update(t){let e=0,o=0;for(let s=e;s<t.length;s++)o=Math.max(o,t[s]);this.canvas.width=this.canvas.offsetWidth*window.devicePixelRatio,this.canvas.height=R.THICKNESS*t.length*window.devicePixelRatio,this.canvas.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio);const n=this.canvas.getContext("2d");n.clearRect(0,0,this.canvas.width,this.canvas.height),n.fillStyle="white",new FontFace("Rubik","url(https://fonts.gstatic.com/s/rubik/v19/iJWZBXyIfDnIV5PNhY1KTN7Z-Yh-B4iFV0UzdYPFkZVO.woff)").load().then(s=>{document.fonts.add(s),n.font="larger Rubik";let a=0;for(let l=e;l<t.length;l++){n.fillText(l===t.length-1?"6+":l+1,0,a+25);let c=t[l]/o*(this.canvas.offsetWidth-R.THICKNESS);(isNaN(c)||c<R.THICKNESS)&&(c=R.THICKNESS),n.fillRect(R.THICKNESS*1.2,a+5,c,R.THICKNESS-10),n.fillStyle="black";const d=10*(String(t[l]).length-1);n.fillText(t[l],c+15-d,a+25),n.fillStyle="white",a+=R.THICKNESS}})}};let W=R;p(W,"THICKNESS",35);const C={DAILY:"daily",TRAINER:"trainer"};let K=localStorage.getItem("gameMode")||C.DAILY;function wt(i){return i===C.DAILY||i===C.TRAINER?(K=i,localStorage.setItem("gameMode",i),!0):!1}function vt(){return K===C.TRAINER}function b(){return K===C.DAILY}const Bt=new U(document.getElementById("feedback"));function Rt(){const i=new m;let t;if(b()){const e=new Date().toDateString();t=X(e)}else{const e=Date.now();t=X(e.toString())}do{const e=q([0,1,2,3,4,5,6,7,8,9,10,11],t),o=q([12,13,14,15,16,17,18,19],t),n=[...e,...o],r=[];for(let s=0;s<12;s++)r.push(Math.floor(t()*2));for(let s=0;s<8;s++)r.push(Math.floor(t()*3));i.currentState=[...n,...r]}while(!i.verifyState());return i.currentState}const k=Rt(),J=$(k),h=new E(k),M=new m;function P(i){const t=document.getElementById(i);t.style.display==="none"?t.style.display="block":t.style.display="none"}let S=JSON.parse(localStorage.getItem("stats"));if(S===null)S=Array(7).fill(0);else if(S.length===22){const i=Array(7).fill(0);for(let t=0;t<Math.min(6,S.length);t++)i[t]=S[t];for(let t=6;t<S.length;t++)i[6]+=S[t];S=i,localStorage.setItem("stats",JSON.stringify(S))}const Dt=new W(document.getElementById("graph"));document.getElementById("open-stats").onclick=()=>{P("stats-container"),Dt.update(S);const i=document.getElementById("countdown-timer");b()?i.style.display="block":i.style.display="none"};document.getElementById("close-stats").onclick=()=>P("stats-container");const N=new Date(new Date().getTime()+24*60*60*1e3);N.setHours(0);N.setMinutes(0);N.setSeconds(0);function z(){const i=Date.parse(N)-Date.parse(new Date),t=Math.floor(i/1e3%60),e=Math.floor(i/1e3/60%60),o=Math.floor(i/(1e3*60*60)%24);document.getElementById("hours").innerText=("0"+o).slice(-2),document.getElementById("minutes").innerText=("0"+e).slice(-2),document.getElementById("seconds").innerText=("0"+t).slice(-2)}z();setInterval(z,1e3);window.feather&&typeof window.feather.replace=="function"&&window.feather.replace();function Q(){const i=document.getElementById("mode-text"),t=document.getElementById("mode-toggle"),e=document.getElementById("new-game");b()?(i.textContent="DAILY MODE",t.textContent="Trainer Mode",e.style.display="none"):(i.textContent="TRAINER MODE",t.textContent="Daily Mode",e.style.display="inline-block")}function Et(){const i=b()?C.TRAINER:C.DAILY;wt(i),Q(),window.location.reload()}function It(){vt()&&(localStorage.removeItem(f("guesses")),localStorage.removeItem(f("score")),localStorage.removeItem(f("complete")),window.location.reload())}document.getElementById("mode-toggle").onclick=Et;document.getElementById("new-game").onclick=It;Q();const Lt=new U(document.getElementById("example"));Lt.drawFace(0,0,"ULDRUFUBU",".XXX.//XX");document.getElementById("open-tutorial").onclick=()=>P("tutorial-container");document.getElementById("read-tutorial").onchange=()=>{document.getElementById("close-tutorial").disabled=!document.getElementById("read-tutorial").checked};document.getElementById("close-tutorial").onclick=()=>{P("tutorial-container"),localStorage.setItem("tutorialComplete",!0)};localStorage.getItem("tutorialComplete")?(document.getElementById("read-tutorial").checked=!0,document.getElementById("close-tutorial").disabled=!1):P("tutorial-container");const T=document.getElementById("guess");T.onclick=tt;T.addEventListener("animationend",()=>T.classList.remove("shake"));function f(i){return(b()?"daily_":"trainer_")+i}window.getStorageKey=f;if(b()){const i=new Date().toDateString();localStorage.getItem("today")!==i?(localStorage.setItem("today",i),localStorage.setItem(f("guesses"),-1),localStorage.setItem(f("score"),JSON.stringify(Array(20).fill(-1))),localStorage.removeItem(f("complete")),h.save()):h.load()}else localStorage.getItem(f("guesses"))?h.load():(localStorage.setItem(f("guesses"),-1),localStorage.setItem(f("score"),JSON.stringify(Array(20).fill(-1))),localStorage.removeItem(f("complete")),h.save());let F=parseInt(localStorage.getItem(f("guesses")))||-1;const H=localStorage.getItem(f("score"));let _=H?JSON.parse(H):Array(20).fill(-1);tt();Y();document.addEventListener("keydown",i=>{if(i.target.tagName==="INPUT"||i.target.tagName==="TEXTAREA"||document.getElementById("stats-container").style.display!=="none"||document.getElementById("tutorial-container").style.display!=="none")return;const t=i.key.toLowerCase();["w","a","s","d"].includes(t)&&(i.preventDefault(),h.navigateWASD(t))});function tt(){if(M.currentState=[...h.permutation,...h.orientation],h.permutation.includes(-1)||!M.verifyState())T.classList.add("shake");else if(F>=6){document.getElementById("parity").innerText="Game Over! Maximum 6 guesses reached.",document.getElementById("picker").replaceChildren(),document.getElementById("actions").replaceChildren(),h.selection.visible=!1;return}else{localStorage.setItem(f("guesses"),F++);const i=document.getElementById("guess-label");i&&(i.textContent=String(F)),h.save(),h.updateParity(),h.initPicker(h.selection);const t=$(M.currentState);if(Bt.drawCube(t,J),Y(),t.toString()===J.toString()){localStorage.getItem(f("complete"))||(localStorage.setItem(f("complete"),!0),S[Math.min(F-1,S.length-1)]++,localStorage.setItem("stats",JSON.stringify(S)));const e=document.getElementById("confetti");e.style.display="block",setTimeout(()=>{mt.create(e,{resize:!0,useWorker:!0})({particleCount:100,spread:135,shapes:["square"],origin:{x:.5,y:.6}}),h.selection.visible=!1,document.getElementById("parity").innerText=`You won in ${F} guesses!`,document.getElementById("picker").replaceChildren();const n=document.createElement("button");n.innerText="\u{1F4CB} Share",n.classList.add("action"),n.style.flex="1",n.onclick=()=>{const r=new Date().toISOString().substring(0,10),s=b()?"Daily":"Trainer",a=`Cuble ${r} (${s}): ${F}/6, ${_.join(" ")}`;navigator.clipboard.writeText(a).then(()=>n.innerText="Copied results to clipboard!",()=>n.innerText="Could not copy to clipboard!")},document.getElementById("actions").replaceChildren(n),setTimeout(()=>e.style.display="none",3e3)},U.DELAY*100)}}}function Ft(i){let t=0;for(let e=0;e<i.length;e++)h.permutation[e]===k[e]&&h.orientation[e]===k[e+20]&&(t++,i[e]===-1&&(i[e]=F));return localStorage.setItem(f("score"),JSON.stringify(i)),t}function Ut(){const i=$([...h.permutation,...h.orientation]);let t=0;for(let e=0;e<54;e++)e%9!==4&&i[e]===J[e]&&t++;return t+6}function Y(){const i=Ft(_),t=Ut();document.getElementById("solved-pieces").textContent=`Pieces: ${i}/20`,document.getElementById("solved-stickers").textContent=`Stickers: ${t}/54`}window.updateStatisticsDisplay=Y;function $(i){const t=i.slice(0,20),e=i.slice(20),o={U:["UBL","UB","URB","UL","U","UR","ULF","UF","UFR"],L:["UBL","UL","ULF","BL","L","FL","DLB","DL","DFL"],F:["ULF","UF","UFR","FL","F","FR","DFL","DF","DRF"],R:["UFR","UR","URB","FR","R","BR","DRF","DR","DBR"],B:["URB","UB","UBL","BR","B","BL","DBR","DB","DLB"],D:["DFL","DF","DRF","DL","D","DR","DLB","DB","DBR"]},n=[];for(const r of"ULFRBD")for(const s of o[r])if(s.length===1)n.push(s);else{const a=E.getStateIndex(s);let l=E.CUBIE_ORDER[t[a]],c=s.indexOf(r);s.length===2?c+=e[a]:s.length===3&&(c+=3-e[a]),n.push(l.charAt(c%l.length))}return n}function q(i,t){for(let e=i.length-1;e>0;e--){let o=Math.floor(t()*(e+1)),n=i[e];i[e]=i[o],i[o]=n}return i}"serviceWorker"in navigator&&St();
