var q=Object.defineProperty;var V=(r,t,e)=>t in r?q(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var p=(r,t,e)=>(V(r,typeof t!="symbol"?t+"":t,e),e);import{v as j,n as z,C as w,M as $,a as J,F as G,B as X,b as Q,S as _,P as tt,W as et,O as it,R as nt,V as rt,s as st,c as ot}from"./vendor.6bafb6cf.js";const at=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}};at();function lt(r={}){const{immediate:t=!1,onNeedRefresh:e,onOfflineReady:n,onRegistered:i,onRegisterError:s}=r;let o,a;const l=async(c=!0)=>{c&&(o==null||o.addEventListener("controlling",h=>{h.isUpdate&&window.location.reload()})),a&&a.waiting&&await z(a.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){o=new j("/cuble/sw.js",{scope:"/cuble/",type:"classic"}),o.addEventListener("activated",c=>{c.isUpdate||n==null||n()});{const c=()=>{e==null||e()};o.addEventListener("waiting",c),o.addEventListener("externalwaiting",c)}o.register({immediate:t}).then(c=>{a=c,i==null||i(c)}).catch(c=>{s==null||s(c)})}return l}var u=function(){this.phase=0,this.currentState=null,this.goalState=null};u.prototype.applyMove=function(r,t){for(var e=[[0,1,2,3,0,1,2,3],[4,7,6,5,4,5,6,7],[0,9,4,8,0,3,5,4],[2,10,6,11,2,1,7,6],[3,11,7,9,3,2,6,5],[1,8,5,10,1,0,4,7]],n=r%3+1,i=Math.floor(r/3),s=t.slice();n-- >0;)for(var o=s.slice(),a=0;a<8;a++){var l=a>3,c=e[i][a]+l*12,h=e[i][(a&3)==3?a-3:a+1]+l*12,m=a<4?i>1&&i<4:i<2?0:2-(a&1);s[c]=o[h],s[c+20]=o[h+20]+m,n==0&&(s[c+20]%=2+l)}return s};u.prototype.inverse=function(r){return r+2-2*(r%3)};u.prototype.getId=function(r){if(this.phase<2)return JSON.stringify(r.slice(20,32));if(this.phase<3){for(var t=r.slice(31,40),e=0;e<12;e++)t[0]|=Math.floor(r[e]/8)<<e;return JSON.stringify(t)}if(this.phase<4){for(var t=[0,0,0],e=0;e<12;e++)t[0]|=(r[e]>7?2:r[e]&1)<<2*e;for(var n=0;n<8;n++)t[1]|=(r[n+12]-12&5)<<3*n;for(var i=12;i<20;i++)for(var s=i+1;s<20;s++)t[2]^=r[i]>r[s];return JSON.stringify(t)}return JSON.stringify(r)};u.prototype.setState=function(r){if(r=r.split(" "),r.length!=20)return this.currentState="Not enough cubies provided",!1;var t=["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL","UFR","URB","UBL","ULF","DRF","DFL","DLB","DBR"];this.currentState=new Array(40),this.goalState=new Array(40);for(var e=0;e<40;e++)this.currentState[e]=0,this.goalState[e]=0;for(var e=0;e<20;e++){this.goalState[e]=e;for(var n=r[e];(this.currentState[e]=t.indexOf(n))==-1;)if(n=n.substr(1)+n[0],this.currentState[e+20]++,this.currentState[e+20]>2)return this.currentState="Cannot solve: Invalid painting of cube.",!1;t[t.indexOf(n)]=""}return this.verifyState()};u.prototype.verifyState=function(){if(!Array.isArray(this.currentState))return!1;var r=0;if(this.currentState.slice(20,32).forEach(function(e){r+=e}),r%2!=0)return this.currentState="Cannot solve: Edges not oriented correctly.",!1;if(r=0,this.currentState.slice(32,40).forEach(function(e){r+=e}),r%3!=0)return this.currentState="Cannot solve: Corners not oriented correctly",!1;var t=function(e){for(var n=0,i=0;i<e.length;i++)for(var s=0;s<i;s++)if(e[s]>e[i]){n++;var o=e[i];e[i]=e[s],e[s]=o}return n};return r=0,r+=t(this.currentState.slice(0,12)),r+=t(this.currentState.slice(12,20)),r%2!=0?(this.currentState="Cannot solve: Parity error only one set of corners or edges swapped.",!1):!0};u.prototype.edgeParity=function(){let r=0;return this.currentState.slice(20,32).forEach(t=>r+=t),r%2};u.prototype.cornerParity=function(){let r=0;return this.currentState.slice(32,40).forEach(t=>r+=t),r%3};u.prototype.permutationParity=function(){if(this.currentState.includes(-1))return"N/A";let r=e=>{let n=0;for(let i=0;i<e.length;i++)for(let s=0;s<i;s++)if(e[s]>e[i]){n++;let o=e[i];e[i]=e[s],e[s]=o}return n},t=r(this.currentState.slice(0,12));return t+=r(this.currentState.slice(12,20)),t%2};u.prototype.solve=function(r){if(this.solution="",this.phase=0,r){if(!this.setState(r))return!1}else if(!this.verifyState())return!1;for(;++this.phase<5;)this.startPhase();return this.prepareSolution(),this.solution};u.prototype.solveAsync=function(r,t,e){if(this.solution="",this.phase=1,r){if(!this.setState(r)){t(!1);return}}else if(!this.verifyState()){t(!1);return}var n=function(){this.phase<5?(this.startPhase(),e&&e(this.phase/5),this.phase++,setTimeout(n.bind(this),0)):(e&&e(1),this.prepareSolution(),t(this.solution))};n.bind(this)()};u.prototype.startPhase=function(){var r=this.getId(this.currentState),t=this.getId(this.goalState);if(r!=t){var e=[];e.push(this.currentState),e.push(this.goalState);var n={},i={},s={};for(i[r]=1,i[t]=2;;)for(var o=e.shift(),a=this.getId(o),l=i[a],c=[0,262143,259263,74943,74898],h=0;h<18;h++)if(c[this.phase]&1<<h){var m=this.applyMove(h,o),f=this.getId(m),v=i[f];if(v&&v!=l){if(l>1){var L=f,f=a,a=L;h=this.inverse(h)}for(var S=[h];a!=r;)S.unshift(s[a]),a=n[a];for(;f!=t;)S.push(this.inverse(s[f])),f=n[f];for(var C=0;C<S.length;C++){for(var T=0;T<S[C]%3+1;T++)this.solution+="UDFBLR"[Math.floor(S[C]/3)];this.currentState=this.applyMove(S[C],this.currentState)}return}v||(e.push(m),i[f]=i[a],s[f]=h,n[f]=a)}}};u.prototype.prepareSolution=function(){var r=this.solution.match(/(\w)\1*/g);if(!r){this.solution="";return}for(var t={F:"B",B:"F",T:"D",D:"T",R:"L",L:"R"},e="",n=0;n<r.length-2;n++)r[n][0]==r[n+2][0]&&t[r[n+1][0]]==r[n][0]&&(temp=r[n+2],r[n+2]=r[n+1],r[n+1]=temp,n=0);r=r.join("").match(/(\w)\1*/g),r.forEach(function(i){if(i.length%4==1)e+=i[0];else if(i.length%4==2)e+=i[0]+"2";else if(i.length%4==3)e+=i[0]+"'";else if(i.length%4==0)return;e+=" "}),this.solution=e.trim()};const N={U:new w(16777215),R:new w(15343619),F:new w(5104690),D:new w(16182581),L:new w(16093725),B:new w(6468577),X:new w(4473924)},d=class{constructor(t){t.width*=window.devicePixelRatio,t.height*=window.devicePixelRatio,t.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),this.canvas=t.getContext("2d"),this.width=t.width,this.height=t.height}drawSquare(t,e,n,i){this.canvas.fillStyle=`rgb(${n.r*256}, ${n.g*256}, ${n.b*256})`,this.canvas.fillRect(t,e,d.SIZE,d.SIZE),i!=="."&&(this.canvas.beginPath(),this.canvas.moveTo(t+d.SIZE,e),this.canvas.lineTo(t,e+d.SIZE),this.canvas.stroke()),i==="X"&&(this.canvas.beginPath(),this.canvas.moveTo(t,e),this.canvas.lineTo(t+d.SIZE,e+d.SIZE),this.canvas.stroke())}drawFace(t,e,n,i){for(let s=0;s<3;s++)for(let o=0;o<3;o++)this.drawSquare(t+s*d.SIZE+s,e+o*d.SIZE+o,N[n[o*3+s]],i[o*3+s])}drawCube(t,e){const n=d.getFeedback(t,e);this.canvas.clearRect(0,0,this.width,this.height),this.drawFace(d.FACESIZE,0,t.slice(0,9),n.slice(0,9));for(let i=0;i<4;i++)this.drawFace(i*d.FACESIZE,d.FACESIZE,t.slice(i*9+9,i*9+18),n.slice(i*9+9,i*9+18));this.drawFace(d.FACESIZE,d.FACESIZE*2,t.slice(45),n.slice(45))}static getFeedback(t,e){const n=[];for(let i=0;i<6;i++){const s={U:0,L:0,F:0,R:0,B:0,D:0},o={U:0,L:0,F:0,R:0,B:0,D:0};for(let a=0;a<9;a++){const l=i*9+a;t[l]!==e[l]&&(a%2===0?o[e[l]]++:s[e[l]]++)}for(let a=0;a<9;a++){const l=i*9+a;t[l]===e[l]?n.push("."):a%2===0&&o[t[l]]-- >0||a%2!==0&&s[t[l]]-- >0?n.push("/"):n.push("X")}}return n}};let B=d;p(B,"SIZE",document.getElementById("feedback").height/10),p(B,"PADDING",5),p(B,"FACESIZE",d.SIZE*3+d.PADDING);class ct extends ${constructor(t,e,n,i){const o=new J({vertexColors:G}),a=[];for(let c=0;c<36;c++)a.push(0,0,0);const l=new X().toNonIndexed();l.setAttribute("color",new Q(a,3));super(l,o);this.position.set(t,e,n),this.scale.set(.95,.95,.95),this.name=i,this.setColors(i)}setColors(t){if(t.length!==this.name.length)throw`Expected ${this.name.length} colors but got ${t}.`;this.colors=t;const e={R:0,L:6,U:12,D:18,F:24,B:30},n=this.geometry.getAttribute("color");for(let i=0;i<this.name.length;i++){const s=N[t.charAt(i)];for(let o=0;o<6;o++)n.setXYZ(e[this.name.charAt(i)]+o,s.r,s.g,s.b)}this.geometry.attributes.color.needsUpdate=!0}erase(){this.setColors("XXX".substring(0,this.name.length))}rotate(){this.setColors(this.colors.substring(1)+this.colors.charAt(0))}}const F=class{constructor(t){p(this,"savedCubies",[]);p(this,"throttle",!0);p(this,"permutation",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);p(this,"orientation",[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);this.scene=new _,this.camera=new tt(90,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(5,5,5),this.renderer=new et({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio?window.devicePixelRatio:1);const e=new it(this.camera,this.renderer.domElement);e.enablePan=!1,e.enableZoom=!1,this.selection=new $(new X,new J({color:"black",transparent:!0,opacity:.5})),this.selection.visible=!1,this.scene.add(this.selection),this.animate(),document.body.appendChild(this.renderer.domElement);const n=["DLB","DL","DFL","BL","L","FL","UBL","UL","ULF","DB","D","DF","B","","F","UB","U","UF","DBR","DR","DRF","BR","R","FR","URB","UR","UFR"];for(let i=0;i<3;i++)for(let s=0;s<3;s++)for(let o=0;o<3;o++){const a=new ct(i-1,s-1,o-1,n[i*9+s*3+o]);this.savedCubies.push(a),this.scene.add(a)}this.renderer.domElement.addEventListener("pointerdown",i=>{this.throttle=!1,this.cursorPos=[i.clientX,i.clientY]}),this.renderer.domElement.addEventListener("pointerup",i=>{if(this.throttle=!0,document.getElementById("actions").childElementCount===1||Math.hypot(i.clientX-this.cursorPos[0],i.clientY-this.cursorPos[1])>1)return;const s=this.findClickedCubie(i);s!==void 0&&this.initPicker(s.object)}),this.answerPermutation=t.slice(0,20),this.answerOrientation=t.slice(20),window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)})}initPicker(t,e){const n=document.getElementById("picker"),i=document.getElementById("erase"),s=document.getElementById("rotate"),o=F.getStateIndex(t.name);if(n.replaceChildren(),!e&&t.position.equals(this.selection.position))this.selection.position.set(0,0,0),this.selection.visible=!1,i.disabled=!0,s.disabled=!0;else{this.selection.position.copy(t.position),this.selection.visible=!0;const a=[];if(t.name.length===1||this.correct(o)){i.disabled=!0,s.disabled=!0,this.selection.material.opacity=.25;return}else t.name.length===2?a.push("UB","UL","DB","DL","BL","FL","UF","UR","DF","DR","BR","FR"):t.name.length===3&&a.push("UBL","ULF","UFR","URB","DLB","DFL","DRF","DBR");this.selection.material.opacity=.5;for(const l of a){const c=l.length===2?6:4,h=n.appendChild(document.createElement("button"));h.classList.add("cubie"),h.style.width=(n.offsetWidth-10*c)/c+"px";const m=h.appendChild(document.createElement("canvas"));m.width=h.clientWidth,m.height=h.clientHeight;const f=m.getContext("2d");for(let v=0;v<l.length;v++){const L=N[l.charAt(v)],S=m.width/l.length;f.fillStyle=`rgb(${L.r*256}, ${L.g*256}, ${L.b*256})`,f.fillRect(S*v,0,S,m.height)}h.disabled=this.permutation.includes(F.getStateIndex(l)),h.onclick=()=>{t.setColors(l),this.permutation[o]=F.getStateIndex(l),this.orientation[o]=0,this.initPicker(t,!0),this.updateParity()}}i.disabled=!1,i.onclick=()=>{t.erase(),this.permutation[o]=-1,this.initPicker(t,!0),this.updateParity()},s.disabled=!1,s.onclick=()=>{t.rotate(),this.orientation[o]--,this.orientation[o]<0&&(this.orientation[o]=t.name.length-1),this.updateParity()}}}updateParity(){const t=new u;t.currentState=[...this.permutation,...this.orientation];const e=t.edgeParity(),n=t.cornerParity(),i=t.permutationParity();document.getElementById("parity").innerText=`EP: ${e}, CP: ${n}, PP: ${i}`,e!==0||n!==0||i!==0?document.getElementById("parity").style.color="red":document.getElementById("parity").style.color="white"}correct(t){const e=JSON.parse(localStorage.getItem("permutation")),n=JSON.parse(localStorage.getItem("orientation"));return e[t]===this.answerPermutation[t]&&n[t]===this.answerOrientation[t]}save(){for(const t of this.savedCubies)localStorage.setItem(t.name,t.colors);localStorage.setItem("permutation",JSON.stringify(this.permutation)),localStorage.setItem("orientation",JSON.stringify(this.orientation))}load(){for(const t of this.savedCubies)t.setColors(localStorage.getItem(t.name));this.permutation=JSON.parse(localStorage.getItem("permutation")),this.orientation=JSON.parse(localStorage.getItem("orientation"))}static getStateIndex(t){return F.CUBIE_ORDER.indexOf(t)}findClickedCubie(t){const e=new rt;e.x=t.clientX/window.innerWidth*2-1,e.y=-(t.clientY/window.innerHeight)*2+1;const n=new nt;return n.setFromCamera(e,this.camera),n.intersectObjects(this.scene.children)[0]}animate(){this.throttle?setTimeout(()=>{requestAnimationFrame(()=>this.animate())},1e3/10):requestAnimationFrame(()=>this.animate()),this.renderer.render(this.scene,this.camera)}};let D=F;p(D,"CUBIE_ORDER",["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL","UFR","URB","UBL","ULF","DRF","DFL","DLB","DBR"]);const y=class{constructor(t){this.canvas=t}update(t){let e=0;for(;t[e]===0&&(e++,e!==15););let n=0;for(let o=e;o<t.length;o++)n=Math.max(n,t[o]);this.canvas.width=this.canvas.offsetWidth*window.devicePixelRatio,this.canvas.height=y.THICKNESS*(t.length-e)*window.devicePixelRatio,this.canvas.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio);const i=this.canvas.getContext("2d");i.clearRect(0,0,this.canvas.width,this.canvas.height),i.fillStyle="white",new FontFace("Rubik","url(https://fonts.gstatic.com/s/rubik/v19/iJWZBXyIfDnIV5PNhY1KTN7Z-Yh-B4iFV0UzdYPFkZVO.woff)").load().then(o=>{document.fonts.add(o),i.font="larger Rubik";let a=0;for(let l=e;l<t.length;l++){i.fillText(l===t.length-1?`>${t.length-2}`:l,0,a+25);let c=t[l]/n*(this.canvas.offsetWidth-y.THICKNESS);(isNaN(c)||c<y.THICKNESS)&&(c=y.THICKNESS),i.fillRect(y.THICKNESS*1.2,a+5,c,y.THICKNESS-10),i.fillStyle="black";const h=10*(String(t[l]).length-1);i.fillText(t[l],c+15-h,a+25),i.fillStyle="white",a+=y.THICKNESS}})}};let k=y;p(k,"THICKNESS",35);const ht=new B(document.getElementById("feedback")),A=new Date().toDateString(),O=st(A),R=new u;do{const r=W([0,1,2,3,4,5,6,7,8,9,10,11]),t=W([12,13,14,15,16,17,18,19]),e=[...r,...t],n=[];for(let i=0;i<12;i++)n.push(Math.floor(O()*2));for(let i=0;i<8;i++)n.push(Math.floor(O()*3));R.currentState=[...e,...n]}while(!R.verifyState());const b=R.currentState,M=Y(b),g=new D(b);function U(r){const t=document.getElementById(r);t.style.display==="none"?t.style.display="block":t.style.display="none"}let I=JSON.parse(localStorage.getItem("stats"));I===null&&(I=Array(22).fill(0));const dt=new k(document.getElementById("graph"));document.getElementById("open-stats").onclick=()=>{U("stats-container"),dt.update(I)};document.getElementById("close-stats").onclick=()=>U("stats-container");const x=new Date(new Date().getTime()+24*60*60*1e3);x.setHours(0);x.setMinutes(0);x.setSeconds(0);function H(){const r=Date.parse(x)-Date.parse(new Date),t=Math.floor(r/1e3%60),e=Math.floor(r/1e3/60%60),n=Math.floor(r/(1e3*60*60)%24);document.getElementById("hours").innerText=("0"+n).slice(-2),document.getElementById("minutes").innerText=("0"+e).slice(-2),document.getElementById("seconds").innerText=("0"+t).slice(-2)}H();setInterval(H,1e3);const ut=new B(document.getElementById("example"));ut.drawFace(0,0,"ULDRUFUBU",".XXX.//XX");document.getElementById("open-tutorial").onclick=()=>U("tutorial-container");document.getElementById("read-tutorial").onchange=()=>{document.getElementById("close-tutorial").disabled=!document.getElementById("read-tutorial").checked};document.getElementById("close-tutorial").onclick=()=>{U("tutorial-container"),localStorage.setItem("tutorialComplete",!0)};localStorage.getItem("tutorialComplete")?(document.getElementById("read-tutorial").checked=!0,document.getElementById("close-tutorial").disabled=!1):U("tutorial-container");const P=document.getElementById("guess");P.onclick=K;P.addEventListener("animationend",()=>P.classList.remove("shake"));localStorage.getItem("today")!==A?(localStorage.setItem("today",A),localStorage.setItem("guesses",-1),localStorage.setItem("score",JSON.stringify(Array(20).fill(-1))),localStorage.removeItem("complete"),g.save()):g.load();let E=localStorage.getItem("guesses"),Z=JSON.parse(localStorage.getItem("score"));K();function K(){if(R.currentState=[...g.permutation,...g.orientation],g.permutation.includes(-1)||!R.verifyState())P.classList.add("shake");else{localStorage.setItem("guesses",E++),document.getElementById("guess").innerText=E+" \u2705",g.save(),g.updateParity(),document.getElementById("parity").innerText+=`, ${ft(Z)}/20 \u2714`,g.initPicker(g.selection);const r=Y(R.currentState);if(ht.drawCube(r,M),r.toString()===M.toString()){localStorage.getItem("complete")||(localStorage.setItem("complete",!0),I[Math.min(E,I.length-1)]++,localStorage.setItem("stats",JSON.stringify(I)));const t=document.getElementById("confetti");t.style.display="block",setTimeout(()=>{ot.create(t,{resize:!0,useWorker:!0})({particleCount:100,spread:135,shapes:["square"],origin:{x:.5,y:.6}}),g.selection.visible=!1,document.getElementById("parity").innerText=`You won in ${E} guesses!`,document.getElementById("picker").replaceChildren();const n=document.createElement("button");n.innerText="\u{1F4CB} Share",n.classList.add("action"),n.style.flex="1",n.onclick=()=>{const s=`Cuble ${new Date().toISOString().substring(0,10)}: ${E}/20, ${Z.join(" ")}`;navigator.clipboard.writeText(s).then(()=>n.innerText="\u2705 Copied results to clipboard!",()=>n.innerText="\u274C Could not copy to clipboard!")},document.getElementById("actions").replaceChildren(n),setTimeout(()=>t.style.display="none",3e3)},B.DELAY*100)}}}function ft(r){let t=0;for(let e=0;e<r.length;e++)g.permutation[e]===b[e]&&g.orientation[e]===b[e+20]&&(t++,r[e]===-1&&(r[e]=E));return localStorage.setItem("score",JSON.stringify(r)),t}function Y(r){const t=r.slice(0,20),e=r.slice(20),n={U:["UBL","UB","URB","UL","U","UR","ULF","UF","UFR"],L:["UBL","UL","ULF","BL","L","FL","DLB","DL","DFL"],F:["ULF","UF","UFR","FL","F","FR","DFL","DF","DRF"],R:["UFR","UR","URB","FR","R","BR","DRF","DR","DBR"],B:["URB","UB","UBL","BR","B","BL","DBR","DB","DLB"],D:["DFL","DF","DRF","DL","D","DR","DLB","DB","DBR"]},i=[];for(const s of"ULFRBD")for(const o of n[s])if(o.length===1)i.push(o);else{const a=D.getStateIndex(o);let l=D.CUBIE_ORDER[t[a]],c=o.indexOf(s);o.length===2?c+=e[a]:o.length===3&&(c+=3-e[a]),i.push(l.charAt(c%l.length))}return i}function W(r){for(let t=r.length-1;t>0;t--){let e=Math.floor(O()*(t+1)),n=r[t];r[t]=r[e],r[e]=n}return r}"serviceWorker"in navigator&&lt();
